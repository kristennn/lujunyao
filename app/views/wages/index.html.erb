

<div id="preloader">
  <div id="status"><i class="fa fa-spinner fa-spin"></i></div>
</div>
<div class="contentpanel">
  <div class="panel panel-body">
    <header style="text-align: center">
      <h4>人员工资页面</h4>
    </header>

    <div class="content-body"> 
      <div class="panel">
        <div class="panel-heading" style="background-color: #fff;">
          <span style="display:inline-block;">
            <span style="display:inline-block;">
              <%= form_tag "#", method: :get do%>
              <%= label_tag :"请选择年份和月份：" %>
              <%= select_tag(:year, options_for_select(Wage.pluck(:year).uniq), {:required => "true"}) %>
              <%= select_tag(:month, options_for_select(Wage.pluck(:month).uniq), {:required => "true"}) %>
              <%= submit_tag :筛选 %>
              <% end %>
            </span>
          </span>
          <span style="float: right;"> 
            <%= link_to("导入工资表", "#", "data-toggle" => "modal", "data-target" => "#myModal1", class:"btn btn-primary-upload pull-right") %>
            <%= link_to("单个录入", "#", "data-toggle" => "modal", "data-target" => "#myModal2", class:"btn btn-primary-upload pull-right") %>
          </span>
        </div>
      </div>
      <div class="content-table" style="clear:both;">
        <table>
          <thead>
            <tr>
              <th>操作</th>
              <th>姓名</th>
              <th>工号</th>
              <th>工种</th>
              <th>本月应发现金</th>
              <th>本月实发现金</th>
              <th>累计未发现金</th>
              <th>本月应发易货币</th>
              <th>本月已消费易货币</th> 
              <th>累计剩余易货币</th>
              <th>日期</th>
            </tr>
          </thead>
          <tbody>
            <% @employees.each do |employee| %>
              <% if Wage.find_by(employee_id: employee.id, year: Time.now.year, month: Time.now.month).present? %>
                <% wage = Wage.find_by(employee_id: employee.id, year: Time.now.year, month: Time.now.month) %>
                <tr class="row-click-able" data-url="/wages/<%= wage.id%>">
                  <td>
                    <%= link_to("发工资", "#",class:"btn btn-primary btn-xs") %>
                    <%= link_to("修改", "#",class:"btn btn-primary btn-xs") %>
                  </td>
                  <td><%= employee.name %></td>
                  <td><%= employee.job_number %></td>
                  <td><%= employee.worktype %></td>
                  <td><%= wage.gross_cash %></td>
                  <td><%= wage.net_cash %></td>
                  <td><%= wage.accumulative_cash %></td>
                  <td><%= wage.gross_virtual_money %></td>
                  <td><%= wage.net_virtual_money %></td>
                  <td><%= wage.accumulative_virtual_money %></td>
                  <td><%= wage.year %>年<%= wage.month %>月</td>
                </tr>
              <% end %>
            <% end %>
          </tbody>
        </table>      
      </div>
    </div>
  </div>
 </div>

<!-- 上传表格弹框代码-开始 -->
<div class="modal fade" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog" style="margin-top:100px;">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
        <h4 class="modal-title" id="myModalLabel">
          上传工资表
        </h4>
      </div>
      <div class="modal-body">
        <% years = (Time.now.year - 1)..(Time.now.year + 1) %>
        <% months = 1..12 %>
        <%= form_tag import_wage_wages_path, method: 'post', multipart: true do %>
          <div class="star_import_model_file_style">
            <ul class ="star_import_model">
              <li>
                  <select name="year">
                    <% years.each do |year| %>
                      <% if year == Time.now.year %>
                        <option value="<%= year %>" selected ><%= year %></option>
                      <% else %>
                        <option value="<%= year %>"><%= year %></option>
                      <% end %>
                    <% end %>
                  </select>
                  <%= label_tag "年" %>
                  <select name="month">
                    <% months.each do |month| %>
                      <% if month == Time.now.month %>
                        <option value="<%= month %>" selected ><%= month %></option>
                      <% else %>
                        <option value="<%= month %>"><%= month %></option>
                      <% end %>
                    <% end %>
                  </select>
                  <%= label_tag "月" %>
                </li>
              <li>
                <%= file_field_tag :file,required: true %>
              </li>
            </ul>
          </div>
          <div class="" style="">
             <%= submit_tag :点击确定,:data => {disable_with: "附件上传中 ... "},:class => "btn btn-primary-status" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
<!-- 上传表格弹框代码-结束 -->

<!-- 单个录入弹框代码-开始 -->
<div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog" style="margin-top:100px;">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
        <h4 class="modal-title" id="myModalLabel">
          单个录入工资
        </h4>
      </div>
      <div class="modal-body">
        <% years = (Time.now.year - 1)..(Time.now.year + 1) %>
        <% months = 1..12 %>
        <% employees = Employee.all %>
        <%= form_for @wage do |f| %>
          <div class="star_import_model_file_style">
            <ul class ="star_import_model">
              <li>
                  <select name="year">
                    <% years.each do |year| %>
                      <% if year == Time.now.year %>
                        <option value="<%= year %>" selected ><%= year %></option>
                      <% else %>
                        <option value="<%= year %>"><%= year %></option>
                      <% end %>
                    <% end %>
                  </select>
                  <%= label_tag "年" %>
                  <select name="month">
                    <% months.each do |month| %>
                      <% if month == Time.now.month %>
                        <option value="<%= month %>" selected ><%= month %></option>
                      <% else %>
                        <option value="<%= month %>"><%= month %></option>
                      <% end %>
                    <% end %>
                  </select>
                  <%= label_tag "月" %>
                </li>
              <li>
                <%= label_tag "选择人员姓名：" %>
                <%= f.select :employee_id, options_for_select(employees.collect{|u| u.name}), required: true %>
              </li>
              <li>
                <%= label_tag "本月应发现金：" %>
                <%= f.text_field :gross_cash, required: true %>
              </li>
              <li>
                <%= label_tag "本月应发易货币：" %>
                <%= f.text_field :gross_virtual_money, required: true %>
              </li>
            </ul>
          </div>
          <div class="" style="">
             <%= submit_tag :点击确定,:data => {disable_with: "附件上传中 ... "},:class => "btn btn-primary-status" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
<!-- 单个录入弹框代码-结束 -->